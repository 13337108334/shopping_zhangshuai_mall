{"ast":null,"code":"import \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.number.to-fixed.js\";\nimport \"core-js/modules/es.json.stringify.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.replace.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport API from \"@/utils/request\";\nimport addressBox from \"@/components/AddressBox\";\nexport default {\n  name: \"cart\",\n  data: function data() {\n    return {\n      baseApi: this.$store.state.baseApi,\n      userId: 0,\n      addressData: [],\n      //临时存储地址信息\n      address: {},\n      checkedIndex: 0,\n      dialogFormVisible: false,\n      good: {},\n      realPrice: -1,\n      goods: [],\n      cartId: \"\"\n    };\n  },\n  components: {\n    \"address-box\": addressBox\n  },\n  created: function created() {\n    this.loadAddress();\n    this.good = JSON.parse(this.$route.query.good);\n    this.good.realPrice = this.$route.query.realPrice;\n    this.good.num = this.$route.query.num;\n    this.good.standard = this.$route.query.standard;\n    this.cartId = this.$route.query.cartId;\n    this.goods.push(this.good);\n  },\n  computed: {\n    //汇总价格\n    sumPrice: function sumPrice() {\n      var sum = 0;\n      this.goods.forEach(function (good) {\n        sum += good.realPrice * good.num;\n      });\n      return sum.toFixed(2);\n    },\n    //汇总折扣\n    sumDiscount: function sumDiscount() {\n      var sum = 0;\n      this.goods.forEach(function (good) {\n        sum += (good.realPrice / good.discount - good.realPrice) * good.num;\n      });\n      return sum.toFixed(2);\n    }\n  },\n  //方法\n  methods: {\n    select: function select(index) {\n      this.checkedIndex = index;\n    },\n    //添加地址弹窗\n    addAddress: function addAddress() {\n      this.address = {};\n      this.dialogFormVisible = true;\n    },\n    //编辑地址弹窗\n    editAddress: function editAddress(item) {\n      //深拷贝\n      this.address = JSON.parse(JSON.stringify(item));\n      this.dialogFormVisible = true;\n    },\n    //删除地址\n    deleteAddress: function deleteAddress(item) {\n      var _this = this;\n\n      this.$confirm(\"您确认删除该地址吗?\", \"提示\", {\n        confirmButtonText: \"确定\",\n        cancelButtonText: \"取消\",\n        type: \"warning\"\n      }).then(function () {\n        API.delete(\"api/address/\" + item.id).then(function (res) {\n          if (res.code === \"200\") {\n            _this.$message.success(\"删除地址成功\");\n\n            _this.loadAddress();\n          }\n        });\n      });\n    },\n    //保存地址\n    saveAddress: function saveAddress() {\n      var _this2 = this;\n\n      this.address.userId = this.userId;\n      API.post(\"/api/address\", this.address).then(function (res) {\n        if (res.code === \"200\") {\n          _this2.$message.success(\"保存成功\");\n\n          _this2.loadAddress();\n\n          _this2.dialogFormVisible = false;\n        } else {\n          _this2.$message.error(res.msg);\n        }\n      });\n    },\n    //加载地址\n    loadAddress: function loadAddress() {\n      var _this3 = this;\n\n      API.get(\"/userid\").then(function (res) {\n        _this3.userId = res;\n        API.get(\"/api/address/\" + res).then(function (res) {\n          if (res.code === \"200\") {\n            _this3.addressData = res.data;\n          }\n        });\n      });\n    },\n    //提交订单\n    submitOrder: function submitOrder() {\n      var _this4 = this;\n\n      var address = this.addressData[this.checkedIndex];\n\n      if (!address) {\n        this.$message({\n          type: \"warning\",\n          message: \"请选择收货地址！\"\n        });\n        return;\n      } //调用提交订单接口\n\n\n      API.post(\"/api/order\", {\n        totalPrice: this.sumPrice,\n        linkUser: address.linkUser,\n        linkPhone: address.linkPhone,\n        linkAddress: address.linkAddress,\n        state: \"待付款\",\n        goods: JSON.stringify(this.goods),\n        cartId: this.cartId\n      }).then(function (res) {\n        if (res.code === \"200\") {\n          var orderNo = res.data; //跳转到支付页面\n\n          _this4.$router.replace({\n            path: \"pay\",\n            query: {\n              money: _this4.sumPrice,\n              orderNo: orderNo\n            }\n          });\n        } else {\n          _this4.$message({\n            type: \"error\",\n            message: res.msg\n          });\n        }\n      });\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgHA;AACA;AACA;AACAA,cADA;AAEAC,MAFA,kBAEA;AACA;AACAC,wCADA;AAEAC,eAFA;AAGAC,qBAHA;AAIA;AACAC,iBALA;AAMAC,qBANA;AAOAC,8BAPA;AAQAC,cARA;AASAC,mBATA;AAUAC,eAVA;AAWAC;AAXA;AAaA,GAhBA;AAiBAC;AACA;AADA,GAjBA;AAoBAC,SApBA,qBAoBA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GA7BA;AA8BAC;AACA;AACAC;AACA;AACA;AACAC;AACA,OAFA;AAGA;AACA,KARA;AASA;AACAC;AACA;AACA;AACAD;AACA,OAFA;AAGA;AACA;AAhBA,GA9BA;AAgDA;AACAE;AACAC,UADA,kBACAC,KADA,EACA;AACA;AACA,KAHA;AAIA;AACAC,cALA,wBAKA;AACA;AACA;AACA,KARA;AASA;AACAC,eAVA,uBAUAC,IAVA,EAUA;AACA;AACA;AACA;AACA,KAdA;AAeA;AACAC,iBAhBA,yBAgBAD,IAhBA,EAgBA;AAAA;;AACA;AACAE,+BADA;AAEAC,8BAFA;AAGAC;AAHA,SAIAC,IAJA,CAIA;AACAC;AACA;AACA;;AACA;AACA;AACA,SALA;AAMA,OAXA;AAYA,KA7BA;AA8BA;AACAC,eA/BA,yBA+BA;AAAA;;AACA;AACAD;AACA;AACA;;AACA;;AACA;AACA,SAJA,MAIA;AACA;AACA;AACA,OARA;AASA,KA1CA;AA2CA;AACAE,eA5CA,yBA4CA;AAAA;;AACAF;AACA;AACAA;AACA;AACA;AACA;AACA,SAJA;AAKA,OAPA;AAQA,KArDA;AAsDA;AACAG,eAvDA,yBAuDA;AAAA;;AACA;;AACA;AACA;AACAL,yBADA;AAEAM;AAFA;AAIA;AACA,OARA,CASA;;;AACAJ;AACAK,iCADA;AAEAC,kCAFA;AAGAC,oCAHA;AAIAC,wCAJA;AAKAC,oBALA;AAMA5B,yCANA;AAOAC;AAPA,SAQAiB,IARA,CAQA;AACA;AACA,iCADA,CAEA;;AACA;AACAW,uBADA;AAEAC;AAAAC;AAAAC;AAAA;AAFA;AAIA,SAPA,MAOA;AACA;AACAf,yBADA;AAEAM;AAFA;AAIA;AACA,OAtBA;AAuBA;AAxFA;AAjDA","names":["name","data","baseApi","userId","addressData","address","checkedIndex","dialogFormVisible","good","realPrice","goods","cartId","components","created","computed","sumPrice","sum","sumDiscount","methods","select","index","addAddress","editAddress","item","deleteAddress","confirmButtonText","cancelButtonText","type","then","API","saveAddress","loadAddress","submitOrder","message","totalPrice","linkUser","linkPhone","linkAddress","state","path","query","money","orderNo"],"sourceRoot":"src/views/front/order","sources":["PreOrder.vue"],"sourcesContent":["<!--\n * 付费订单页面\n *\n<<<<<<< HEAD\n * @author: ZhangDaYe\n=======\n * @Author: ShanZhu\n>>>>>>> origin/feature_2024_08_24\n * @Date: 2023-11-11\n-->\n<template>\n  <div style=\"margin-top: 10px; width: 90%; margin: 10px auto\">\n    <div style=\"background-color: white; padding: 10px; border-radius: 12px\">\n      <!--收货地址-->\n      <div style=\"\n          padding: 10px;\n          margin-bottom: 20px;\n          border-bottom: 1px solid #eee;\n        \"\n      >\n        <div style=\"\n            font-size: 20px;\n            border-bottom: 2px solid dodgerblue;\n            padding-bottom: 10px;\n            margin-bottom: 20px;\n          \"\n        >\n          收货地址\n          <el-button style=\"height: 25px; padding: 5px\" @click=\"addAddress\">+</el-button>\n        </div>\n        <template v-for=\"(item, index) in addressData\">\n          <address-box\n            :address=\"item\"\n            :key=\"index\"\n            :class=\"index === checkedIndex ? 'active' : ' '\"\n            style=\"margin-right: 20px;cursor:pointer;\"\n            @edit=\"editAddress(item)\"\n            @delete=\"deleteAddress(item)\"\n            @click.native=\"select(index)\"\n          ></address-box>\n        </template>\n      </div>\n\n      <!--地址弹窗-->\n      <el-dialog title=\"地址信息\" :visible.sync=\"dialogFormVisible\">\n        <el-form label-width=\"90px\" style=\"padding: 0 60px\">\n          <el-form-item label=\"联系人\">\n            <el-input v-model=\"address.linkUser\" autocomplete=\"off\"></el-input>\n          </el-form-item>\n          <el-form-item label=\"联系电话\">\n            <el-input v-model=\"address.linkPhone\" autocomplete=\"off\"></el-input>\n          </el-form-item>\n          <el-form-item label=\"地址\">\n            <el-input\n              v-model=\"address.linkAddress\"\n              autocomplete=\"off\"\n            ></el-input>\n          </el-form-item>\n        </el-form>\n        <div slot=\"footer\" class=\"dialog-footer\">\n          <el-button @click=\"dialogFormVisible = false\">取 消</el-button>\n          <el-button type=\"primary\" @click=\"saveAddress\">确 定</el-button>\n        </div>\n      </el-dialog>\n\n      <!--商品确认-->\n      <el-table :data=\"goods\" stripe style=\"width: 100%\">\n        <el-table-column label=\"商品图片\" width=\"150\">\n          <template slot-scope=\"scope\">\n            <el-image\n              :src=\"baseApi + scope.row.imgs\"\n              style=\"width: 100px; height: 100px\"\n              fit=\"contain\"\n            ></el-image>\n          </template>\n        </el-table-column>\n        <el-table-column prop=\"name\" label=\"商品名称\"></el-table-column>\n        <el-table-column prop=\"standard\" label=\"规格\"></el-table-column>\n        <el-table-column prop=\"realPrice\" label=\"单价\"></el-table-column>\n        <el-table-column prop=\"num\" label=\"数量\"></el-table-column>\n        <el-table-column label=\"价格\">\n          <template slot-scope=\"scope\">\n            {{ (scope.row.realPrice * scope.row.num).toFixed(2) }}\n          </template>\n        </el-table-column>\n      </el-table>\n\n      <div style=\"margin-top: 10px\">\n        <div style=\"background-color: white; padding: 10px\">\n          <div style=\"color: red; text-align: right\">\n            <div>\n              <span>总价：</span>\n              <span>￥ {{ sumPrice }}</span>\n            </div>\n            <div style=\"text-align: right; color: #999; font-size: 12px\">\n              优惠： ￥{{ sumDiscount }}\n            </div>\n            <div style=\"padding: 10px 0\">\n              <el-button\n                style=\"background-color: red; color: white; width: 100px\"\n                @click=\"submitOrder\"\n                >提交订单</el-button\n              >\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport API from \"@/utils/request\";\nimport addressBox from \"@/components/AddressBox\";\nexport default {\n  name: \"cart\",\n  data() {\n    return {\n      baseApi: this.$store.state.baseApi,\n      userId: 0,\n      addressData: [],\n      //临时存储地址信息\n      address: {},\n      checkedIndex: 0,\n      dialogFormVisible: false,\n      good: {},\n      realPrice: -1,\n      goods: [],\n      cartId: \"\",\n    };\n  },\n  components: {\n    \"address-box\": addressBox,\n  },\n  created() {\n    this.loadAddress();\n\n    this.good = JSON.parse(this.$route.query.good);\n    this.good.realPrice = this.$route.query.realPrice;\n    this.good.num = this.$route.query.num;\n    this.good.standard = this.$route.query.standard;\n    this.cartId = this.$route.query.cartId;\n    this.goods.push(this.good);\n  },\n  computed: {\n    //汇总价格\n    sumPrice: function () {\n      let sum = 0;\n      this.goods.forEach(function (good) {\n        sum += good.realPrice * good.num;\n      });\n      return sum.toFixed(2);\n    },\n    //汇总折扣\n    sumDiscount: function () {\n      let sum = 0;\n      this.goods.forEach(function (good) {\n        sum += (good.realPrice / good.discount - good.realPrice) * good.num;\n      });\n      return sum.toFixed(2);\n    },\n  },\n  //方法\n  methods: {\n    select(index) {\n      this.checkedIndex = index;\n    },\n    //添加地址弹窗\n    addAddress() {\n      this.address = {};\n      this.dialogFormVisible = true;\n    },\n    //编辑地址弹窗\n    editAddress(item) {\n      //深拷贝\n      this.address = JSON.parse(JSON.stringify(item));\n      this.dialogFormVisible = true;\n    },\n    //删除地址\n    deleteAddress(item) {\n      this.$confirm(\"您确认删除该地址吗?\", \"提示\", {\n        confirmButtonText: \"确定\",\n        cancelButtonText: \"取消\",\n        type: \"warning\",\n      }).then(() => {\n        API.delete(\"api/address/\" + item.id).then((res) => {\n          if (res.code === \"200\") {\n            this.$message.success(\"删除地址成功\");\n            this.loadAddress();\n          }\n        });\n      });\n    },\n    //保存地址\n    saveAddress() {\n      this.address.userId = this.userId;\n      API.post(\"/api/address\", this.address).then((res) => {\n        if (res.code === \"200\") {\n          this.$message.success(\"保存成功\");\n          this.loadAddress();\n          this.dialogFormVisible = false;\n        } else {\n          this.$message.error(res.msg);\n        }\n      });\n    },\n    //加载地址\n    loadAddress() {\n      API.get(\"/userid\").then((res) => {\n        this.userId = res;\n        API.get(\"/api/address/\" + res).then((res) => {\n          if (res.code === \"200\") {\n            this.addressData = res.data;\n          }\n        });\n      });\n    },\n    //提交订单\n    submitOrder() {\n      let address = this.addressData[this.checkedIndex];\n      if (!address) {\n        this.$message({\n          type: \"warning\",\n          message: \"请选择收货地址！\",\n        });\n        return;\n      }\n      //调用提交订单接口\n      API.post(\"/api/order\", {\n        totalPrice: this.sumPrice,\n        linkUser: address.linkUser,\n        linkPhone: address.linkPhone,\n        linkAddress: address.linkAddress,\n        state: \"待付款\",\n        goods: JSON.stringify(this.goods),\n        cartId: this.cartId,\n      }).then((res) => {\n        if (res.code === \"200\") {\n          let orderNo = res.data;\n          //跳转到支付页面\n          this.$router.replace({\n            path: \"pay\",\n            query: { money: this.sumPrice, orderNo: orderNo },\n          });\n        } else {\n          this.$message({\n            type: \"error\",\n            message: res.msg,\n          });\n        }\n      });\n    },\n  },\n};\n</script>\n\n<style scoped>\n.active {\n  border: black 5px solid;\n}\n</style>\n"]},"metadata":{},"sourceType":"module"}