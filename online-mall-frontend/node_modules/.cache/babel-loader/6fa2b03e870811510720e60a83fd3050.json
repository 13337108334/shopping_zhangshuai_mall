{"ast":null,"code":"import \"core-js/modules/es.array.splice.js\";\nimport \"core-js/modules/es.array.slice.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.string.trim.js\";\nimport \"core-js/modules/es.symbol.js\";\nimport \"core-js/modules/es.symbol.description.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport API from \"@/utils/request\";\nvar url = \"/api/good\";\nexport default {\n  name: \"GoodInfo\",\n  data: function data() {\n    return {\n      baseApi: this.$store.state.baseApi,\n      good: {\n        discount: \"1\"\n      },\n      standards: [],\n      index: 0,\n      standard: {},\n      fileList: [],\n      dialogFormVisible: false,\n      categoryItems: [],\n      checkedCategory: {}\n    };\n  },\n  created: function created() {\n    var _this = this;\n\n    this.request.get(\"/api/category\").then(function (res) {\n      if (res.code === \"200\") {\n        _this.categoryItems = res.data;\n      }\n\n      if (_this.$route.query.good) {\n        _this.good = JSON.parse(_this.$route.query.good);\n        _this.fileList = [{\n          name: \"原始图片\",\n          url: _this.good.imgs\n        }];\n        _this.checkedCategory = _this.categoryItems[_this.good.categoryId]; //从服务器获取商品规格信息\n\n        _this.request.get(url + \"/standard/\" + _this.good.id).then(function (res) {\n          if (res.code === \"200\") {\n            var standards = JSON.parse(res.data);\n            _this.standards = standards;\n          } else {//没有规格\n          }\n        });\n      }\n    });\n  },\n  methods: {\n    /*\n    规格操作\n     */\n    editStandard: function editStandard(index) {\n      this.standard = this.standards[index];\n      this.index = index;\n      this.dialogFormVisible = true;\n    },\n    addStandard: function addStandard() {\n      this.standard = {};\n      this.index = this.standards.length;\n      this.dialogFormVisible = true;\n    },\n    saveStandard: function saveStandard() {\n      if (this.standard.value == undefined || this.standard.value == \"\") {\n        this.$message({\n          type: \"error\",\n          message: \"请输入规格名称\",\n          showClose: true\n        });\n        return;\n      }\n\n      if (this.standard.price == undefined || this.standard.price == \"\") {\n        this.$message({\n          type: \"error\",\n          message: \"请输入价格\",\n          showClose: true\n        });\n        return;\n      }\n\n      if (this.standard.store == undefined || this.standard.store == \"\") {\n        this.$message({\n          type: \"error\",\n          message: \"请输入库存\",\n          showClose: true\n        });\n        return;\n      }\n\n      this.standards[this.index] = this.standard;\n      this.dialogFormVisible = false;\n    },\n    handleClose: function handleClose(standard) {\n      this.standards.splice(this.standards.indexOf(standard), 1);\n    },\n\n    /*\n    文件上传操作\n     */\n    handleImgSuccess: function handleImgSuccess(res) {\n      this.good.imgs = res.data;\n      this.save();\n    },\n    handleChange: function handleChange(file, fileList) {\n      this.fileList = fileList.slice(-3);\n    },\n    handleRemove: function handleRemove() {\n      this.fileList.pop();\n    },\n\n    /*\n    保存数据操作\n     */\n    //点击提交按钮\n    submit: function submit() {\n      if (this.good.name == undefined || this.good.name.trim() == \"\") {\n        this.$message({\n          type: \"error\",\n          message: \"请输入商品名称\",\n          showClose: true\n        });\n        return false;\n      }\n\n      if (this.good.description == undefined || this.good.description.trim() == \"\") {\n        this.$message({\n          type: \"error\",\n          message: \"请输入商品描述\",\n          showClose: true\n        });\n        return false;\n      }\n\n      if (this.standards.length === 0) {\n        this.$message({\n          type: \"error\",\n          message: \"请至少添加一个规格\",\n          showClose: true\n        });\n        return false;\n      }\n\n      if (this.good.discount == undefined || this.good.discount === \"\") {\n        this.$message({\n          type: \"error\",\n          message: \"请输入商品折扣\",\n          showClose: true\n        });\n        return false;\n      }\n\n      if (this.good.categoryId == undefined) {\n        this.$message({\n          type: \"error\",\n          message: \"请选择商品分类\",\n          showClose: true\n        });\n        return false;\n      }\n\n      if (this.fileList.length === 0) {\n        this.$message({\n          type: \"error\",\n          message: \"请上传图片\",\n          showClose: true\n        });\n        return false;\n      } // 先上传图片再保存数据\n\n\n      if (this.fileList[0].status === \"ready\") {\n        this.$refs.upload.submit();\n      } else if (this.fileList[0].status === \"success\") {\n        //没有修改初始的图片。直接保存数据\n        this.save();\n      }\n    },\n    //保存数据\n    save: function save() {\n      var _this2 = this;\n\n      API.post(url, this.good).then(function (res2) {\n        if (res2.code === \"200\") {\n          _this2.good.id = res2.data;\n\n          _this2.request.post(url + \"/standard?goodId=\" + _this2.good.id, _this2.standards).then(function (res) {\n            if (res.code === \"200\") {\n              _this2.$message({\n                type: \"success\",\n                message: \"操作成功\",\n                showClose: true\n              });\n\n              _this2.$router.go(-1);\n            } else {\n              _this2.$message({\n                type: \"error\",\n                message: \"操作失败\",\n                showClose: true\n              });\n            }\n          });\n        } else {\n          _this2.$message({\n            type: \"error\",\n            message: res2.msg\n          });\n        }\n      });\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuHA;AACA;AACA;AACAA,kBADA;AAEAC,MAFA,kBAEA;AACA;AACAC,wCADA;AAEAC;AACAC;AADA,OAFA;AAKAC,mBALA;AAMAC,cANA;AAOAC,kBAPA;AAQAC,kBARA;AASAC,8BATA;AAUAC,uBAVA;AAWAC;AAXA;AAaA,GAhBA;AAiBAC,SAjBA,qBAiBA;AAAA;;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;AAAAZ;AAAAa;AAAA;AACA,2EAHA,CAIA;;AACA;AACA;AACA;AACA;AACA,WAHA,MAGA,CACA;AACA;AACA,SAPA;AAQA;AACA,KAlBA;AAmBA,GArCA;AAsCAC;AACA;AACA;AACA;AACAC,gBAJA,wBAIAT,KAJA,EAIA;AACA;AACA;AACA;AACA,KARA;AASAU,eATA,yBASA;AACA;AACA;AACA;AACA,KAbA;AAcAC,gBAdA,0BAcA;AACA;AAEA;AACAC,uBADA;AAEAC,4BAFA;AAGAC;AAHA;AAKA;AACA;;AACA;AACA;AACAF,uBADA;AAEAC,0BAFA;AAGAC;AAHA;AAKA;AACA;;AACA;AACA;AACAF,uBADA;AAEAC,0BAFA;AAGAC;AAHA;AAKA;AACA;;AACA;AACA;AACA,KA1CA;AA2CAC,eA3CA,uBA2CAd,QA3CA,EA2CA;AACA;AACA,KA7CA;;AA8CA;AACA;AACA;AACAe,oBAjDA,4BAiDAC,GAjDA,EAiDA;AACA;AACA;AACA,KApDA;AAqDAC,gBArDA,wBAqDAC,IArDA,EAqDAjB,QArDA,EAqDA;AACA;AACA,KAvDA;AAwDAkB,gBAxDA,0BAwDA;AACA;AACA,KA1DA;;AA2DA;AACA;AACA;AACA;AACAC,UA/DA,oBA+DA;AACA;AACA;AACAT,uBADA;AAEAC,4BAFA;AAGAC;AAHA;AAKA;AACA;;AACA,UACA,sCACA,kCAFA,EAGA;AACA;AACAF,uBADA;AAEAC,4BAFA;AAGAC;AAHA;AAKA;AACA;;AACA;AACA;AACAF,uBADA;AAEAC,8BAFA;AAGAC;AAHA;AAKA;AACA;;AACA;AACA;AACAF,uBADA;AAEAC,4BAFA;AAGAC;AAHA;AAKA;AACA;;AACA,UACA,iCADA,EAEA;AACA;AACAF,uBADA;AAEAC,4BAFA;AAGAC;AAHA;AAKA;AACA;;AACA;AACA;AACAF,uBADA;AAEAC,0BAFA;AAGAC;AAHA;AAKA;AACA,OArDA,CAsDA;;;AACA;AACA;AACA,OAFA,MAEA;AACA;AACA;AACA;AACA,KA5HA;AA6HA;AACAQ,QA9HA,kBA8HA;AAAA;;AACAC;AACA;AACA;;AACA,yBACAC,IADA,CACAjB,0CADA,EACA,gBADA,EAEAkB,IAFA,CAEA;AACA;AACA;AACAb,+BADA;AAEAC,+BAFA;AAGAC;AAHA;;AAKA;AACA,aAPA,MAOA;AACA;AACAF,6BADA;AAEAC,+BAFA;AAGAC;AAHA;AAKA;AACA,WAjBA;AAkBA,SApBA,MAoBA;AACA;AACAF,yBADA;AAEAC;AAFA;AAIA;AACA,OA3BA;AA4BA;AA3JA;AAtCA","names":["name","data","baseApi","good","discount","standards","index","standard","fileList","dialogFormVisible","categoryItems","checkedCategory","created","url","methods","editStandard","addStandard","saveStandard","type","message","showClose","handleClose","handleImgSuccess","res","handleChange","file","handleRemove","submit","save","API","post","then"],"sourceRoot":"src/views/manage/good","sources":["GoodInfo.vue"],"sourcesContent":["<!--\n * 商品信息\n *\n * @author: ZhangDaYe\n * @Date: 2023-11-11\n-->\n<template>\n  <div style=\"width: 1000px; margin: 50px auto\">\n    <el-form :model=\"good\">\n      <el-form-item label=\"商品名称\" label-width=\"150px\">\n        <el-input\n          v-model=\"good.name\"\n          autocomplete=\"off\"\n          style=\"width: 80%\"\n        ></el-input>\n      </el-form-item>\n      <el-form-item label=\"商品描述\" label-width=\"150px\">\n        <el-input\n          v-model=\"good.description\"\n          autocomplete=\"off\"\n          style=\"width: 80%\"\n        ></el-input>\n      </el-form-item>\n      <el-form-item label=\"规格\" label-width=\"150px\">\n        <el-tag\n          closable\n          @close=\"handleClose(standard)\"\n          :disable-transitions=\"true\"\n          style=\"margin-right: 10px\"\n          v-for=\"(standard, index) in standards\"\n          :key=\"index\"\n          @click=\"editStandard(index)\"\n          >{{ standard.value }}</el-tag\n        >\n        <el-button icon=\"el-icon-plus\" circle @click=\"addStandard\"></el-button>\n      </el-form-item>\n\n      <el-form-item label=\"折扣\" label-width=\"150px\">\n        <el-input\n          v-model=\"good.discount\"\n          autocomplete=\"off\"\n          style=\"width: 80%\"\n        ></el-input>\n      </el-form-item>\n\n      <el-form-item label=\"分类\" label-width=\"150px\">\n        <el-select v-model=\"good.categoryId\" placeholder=\"请选择\">\n          <el-option\n            v-for=\"item in categoryItems\"\n            :key=\"item.id\"\n            :label=\"item.name\"\n            :value=\"item.id\"\n          >\n          </el-option>\n        </el-select>\n      </el-form-item>\n      <el-form-item label=\"商品图片\" label-width=\"150px\">\n        <el-upload\n          class=\"upload-demo\"\n          ref=\"upload\"\n          :action=\"baseApi + '/file/upload'\"\n          :file-list=\"fileList\"\n          :on-change=\"handleChange\"\n          :limit=\"1\"\n          :on-remove=\"handleRemove\"\n          :on-success=\"handleImgSuccess\"\n          :auto-upload=\"false\"\n        >\n          <el-button slot=\"trigger\" size=\"small\" type=\"primary\"\n            >选取文件</el-button\n          >\n          <div slot=\"tip\" class=\"el-upload__tip\">\n            只能上传一个jpg/png文件，且不超过500kb\n          </div>\n        </el-upload>\n      </el-form-item>\n      <el-form-item label-width=\"150px\">\n        <el-button type=\"success\" @click=\"submit\">提交</el-button>\n      </el-form-item>\n    </el-form>\n    <!-- 弹窗   -->\n    <el-dialog\n      title=\"规格信息\"\n      :visible.sync=\"dialogFormVisible\"\n      width=\"30%\"\n      :close-on-click-modal=\"false\"\n    >\n      <el-form :model=\"standard\">\n        <el-form-item label=\"规格名称\" label-width=\"150px\">\n          <el-input\n            v-model=\"standard.value\"\n            autocomplete=\"off\"\n            style=\"width: 80%\"\n          ></el-input>\n        </el-form-item>\n        <el-form-item label=\"价格\" label-width=\"150px\">\n          <el-input\n            v-model=\"standard.price\"\n            autocomplete=\"off\"\n            style=\"width: 80%\"\n          ></el-input>\n        </el-form-item>\n        <el-form-item label=\"库存\" label-width=\"150px\">\n          <el-input\n            v-model=\"standard.store\"\n            autocomplete=\"off\"\n            style=\"width: 80%\"\n          ></el-input>\n        </el-form-item>\n      </el-form>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"dialogFormVisible = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"saveStandard\">确 定</el-button>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport API from \"@/utils/request\";\nconst url = \"/api/good\";\nexport default {\n  name: \"GoodInfo\",\n  data() {\n    return {\n      baseApi: this.$store.state.baseApi,\n      good: {\n        discount: \"1\",\n      },\n      standards: [],\n      index: 0,\n      standard: {},\n      fileList: [],\n      dialogFormVisible: false,\n      categoryItems: [],\n      checkedCategory: {},\n    };\n  },\n  created() {\n    this.request.get(\"/api/category\").then((res) => {\n      if (res.code === \"200\") {\n        this.categoryItems = res.data;\n      }\n      if (this.$route.query.good) {\n        this.good = JSON.parse(this.$route.query.good);\n        this.fileList = [{ name: \"原始图片\", url: this.good.imgs }];\n        this.checkedCategory = this.categoryItems[this.good.categoryId];\n        //从服务器获取商品规格信息\n        this.request.get(url + \"/standard/\" + this.good.id).then((res) => {\n          if (res.code === \"200\") {\n            let standards = JSON.parse(res.data);\n            this.standards = standards;\n          } else {\n            //没有规格\n          }\n        });\n      }\n    });\n  },\n  methods: {\n    /*\n    规格操作\n     */\n    editStandard(index) {\n      this.standard = this.standards[index];\n      this.index = index;\n      this.dialogFormVisible = true;\n    },\n    addStandard() {\n      this.standard = {};\n      this.index = this.standards.length;\n      this.dialogFormVisible = true;\n    },\n    saveStandard() {\n      if (this.standard.value == undefined || this.standard.value == \"\") {\n\n        this.$message({\n          type: \"error\",\n          message: \"请输入规格名称\",\n          showClose: true,\n        });\n        return;\n      }\n      if (this.standard.price == undefined || this.standard.price == \"\") {\n        this.$message({\n          type: \"error\",\n          message: \"请输入价格\",\n          showClose: true,\n        });\n        return;\n      }\n      if (this.standard.store == undefined || this.standard.store == \"\") {\n        this.$message({\n          type: \"error\",\n          message: \"请输入库存\",\n          showClose: true,\n        });\n        return;\n      }\n      this.standards[this.index] = this.standard;\n      this.dialogFormVisible = false;\n    },\n    handleClose(standard) {\n      this.standards.splice(this.standards.indexOf(standard), 1);\n    },\n    /*\n    文件上传操作\n     */\n    handleImgSuccess(res) {\n      this.good.imgs = res.data;\n      this.save();\n    },\n    handleChange(file, fileList) {\n      this.fileList = fileList.slice(-3);\n    },\n    handleRemove() {\n      this.fileList.pop();\n    },\n    /*\n    保存数据操作\n     */\n    //点击提交按钮\n    submit() {\n      if (this.good.name == undefined || this.good.name.trim() == \"\") {\n        this.$message({\n          type: \"error\",\n          message: \"请输入商品名称\",\n          showClose: true,\n        });\n        return false;\n      }\n      if (\n        this.good.description == undefined ||\n        this.good.description.trim() == \"\"\n      ) {\n        this.$message({\n          type: \"error\",\n          message: \"请输入商品描述\",\n          showClose: true,\n        });\n        return false;\n      }\n      if (this.standards.length === 0) {\n        this.$message({\n          type: \"error\",\n          message: \"请至少添加一个规格\",\n          showClose: true,\n        });\n        return false;\n      }\n      if (this.good.discount == undefined || this.good.discount === \"\") {\n        this.$message({\n          type: \"error\",\n          message: \"请输入商品折扣\",\n          showClose: true,\n        });\n        return false;\n      }\n      if (\n        this.good.categoryId == undefined\n      ) {\n        this.$message({\n          type: \"error\",\n          message: \"请选择商品分类\",\n          showClose: true,\n        });\n        return false;\n      }\n      if (this.fileList.length === 0) {\n        this.$message({\n          type: \"error\",\n          message: \"请上传图片\",\n          showClose: true,\n        });\n        return false;\n      }\n      // 先上传图片再保存数据\n      if (this.fileList[0].status === \"ready\") {\n        this.$refs.upload.submit();\n      } else if (this.fileList[0].status === \"success\") {\n        //没有修改初始的图片。直接保存数据\n        this.save();\n      }\n    },\n    //保存数据\n    save() {\n      API.post(url, this.good).then((res2) => {\n        if (res2.code === \"200\") {\n          this.good.id = res2.data;\n          this.request\n            .post(url + \"/standard?goodId=\" + this.good.id, this.standards)\n            .then((res) => {\n              if (res.code === \"200\") {\n                this.$message({\n                  type: \"success\",\n                  message: \"操作成功\",\n                  showClose: true,\n                });\n                this.$router.go(-1);\n              } else {\n                this.$message({\n                  type: \"error\",\n                  message: \"操作失败\",\n                  showClose: true,\n                });\n              }\n            });\n        } else {\n          this.$message({\n            type: \"error\",\n            message: res2.msg,\n          });\n        }\n      });\n    },\n  },\n};\n</script>\n\n<style scoped>\n</style>\n"]},"metadata":{},"sourceType":"module"}